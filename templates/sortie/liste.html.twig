{% extends 'base.html.twig' %}

{% block title %}Les Sorties{% endblock %}

{% block body %}
    <h2 class="text-center mb-4">Les Sorties !</h2>
    <nav class="navbar bg-body-tertiary">
        <div class="container-fluid">
            <label>
                <input type="checkbox" id="filterCheckboxOrganisateur"> Afficher uniquement mes sorties organisées
            </label>
            <br>
            <label>
                <input type="checkbox" id="filterCheckboxInscrit"> Afficher uniquement les sorties auxquelles je suis inscrit
            </label>
            <br>
            <label>
                <input type="checkbox" id="filterCheckboxNonInscrit"> Afficher uniquement les sorties auxquelles je ne suis pas inscrit
            </label>
            <form class="d-flex" role="search">
                <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success" type="submit">Search</button>
            </form>
        </div>
    </nav>
    <div class="container mt-4">
        <h2 class="text-center mb-4">Les Sorties !</h2>

        {# Formulaire de recherche #}
        <div class="card mb-4">
            <div class="card-header">
                <h3 class="card-title">Rechercher des sorties</h3>
            </div>
            <div class="card-body">
                {{ form_start(rechercheForm, {'attr': {'id': 'filter-form'}}) }}
                <div class="row">
                    <div class="col-md-4">
                        {{ form_row(rechercheForm.nom) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(rechercheForm.dateDebut) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(rechercheForm.organisateur) }}
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-4">
                        {{ form_row(rechercheForm.participants) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(rechercheForm.nonParticipants) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(rechercheForm.sorties) }}
                    </div>
                    <div class="col-md-4">
                        {{ form_row(rechercheForm.lieu) }}
                    </div>
                </div>
                <div class="text-center mt-3">
                    {{ form_row(rechercheForm.search, {'attr': {'class': 'btn btn-primary'}}) }}
                </div>
                {{ form_end(rechercheForm) }}
            </div>
        </div>

    <div class="table-responsive" style="justify-items: center">
        <table class="table table-striped table-bordered text-center">
            <thead class="table-dark">
            <tr>
                <th>Nom de la sortie</th>
                <th>Date de la sortie</th>
                <th>Clôture</th>
                <th>Inscrits / Places</th>
                <th>État</th>
                <th>Inscrit</th>
                <th>Organisateur</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody>

            {% for sortie in sorties %}
                {% if sortie %}
                    {% if (sortie.etat.libelle == 'Créée' and sortie.organisateur == app.user)
                        or (sortie.etat.libelle != 'Créée' and sortie.etat.libelle != 'Archivée') %}
                        <tr class="sortie"
                            data-id="{{ sortie.id }}"
                            data-inscrit="{% if sortie.participants.contains(app.user) %}1{% else %}0{% endif %}"
                            data-non-inscrit="{% if sortie.participants.contains(app.user) %}0{% else %}1{% endif %}"
                            data-organisateur="{% if sortie.organisateur == app.user %}1{% else %}0{% endif %}">

                            <td>{{ sortie.nomSortie }} ({{ sortie.id }})</td>
                        <td>{{ sortie.dateHeureDebut.format('d/m/Y à H:i') }}</td>
                        <td>{{ sortie.dateLimiteInscription.format('d/m/Y') }}</td>
                        <td><span class="badge bg-primary">{{ sortie.participants.count() }} </span> / {{ sortie.nbInscriptionsMax }} </td>

                            <td>
                                {% if sortie.etat.libelle == 'Créée' %}
                                    <span class="badge bg-warning text-white">{{ sortie.etat.libelle }}</span>
                                {% elseif sortie.etat.libelle == 'Ouverte' %}
                                    <span class="badge bg-info text-white">{{ sortie.etat.libelle }}</span>
                                {% elseif sortie.etat.libelle == 'Clôturée' %}
                                    <span class="badge bg-danger text-white">{{ sortie.etat.libelle }}</span>
                                {% else %}
                                    <span class="badge bg-secondary text-grey">{{ sortie.etat.libelle }}</span>
                                {% endif %}

                            </td>
                            <td>
                                {% if sortie.participants.contains(app.user) %}
                                    <span class="badge bg-success">Oui</span>
                                {% endif %}
                            </td>

                            <td>
                                <a type="button" class="btn btn-outline-secondary" href="{{ path('participant_detail', {'id': sortie.organisateur.id}) }}">
                                    {{ sortie.organisateur.pseudo }}
                                </a>
                            </td>

                            <td>
                                <a href='{{ path('sortie_detail', {'id': sortie.id}) }}' class="btn btn-sm btn-outline-primary">Afficher</a>
                                {% if app.user %}
                                    {% if sortie.organisateur != app.user %}
                                    {% if (sortie.etat.libelle == 'Ouverte' or (sortie.etat.libelle == 'Clôturée' and sortie.participants.contains(app.user)))  %}
                                        {% if sortie.participants.contains(app.user) %}
                                            <a href="{{ path('sortie_desister', {'id': sortie.id}) }}" class="btn btn-sm btn-outline-success">Se désister</a>
                                        {% else %}
                                            <a href="{{ path('sortie_inscrire', {'id': sortie.id}) }}" class="btn btn-sm btn-outline-success">S'inscrire</a>
                                        {% endif %}
                                    {% endif %}
                                    {% endif %}
                                    {% if sortie.organisateur == app.user %}
                                        {% if sortie.etat.libelle in ['Ouverte', 'Créée'] %}
                                            <a href="{{ path('sortie_update', {'id': sortie.id}) }}" class="btn btn-sm btn-outline-success">Modifier</a>
                                            <a href="{{ path('sortie_annulation', {'id': sortie.id}) }}" class="btn btn-sm btn-outline-danger">Annuler</a>
                                        {% endif %}
                                    {% endif %}
                                {% endif %}
                            </td>
                        </tr>

                    {% endif %}
                {% else %}
                    <tr>
                        <td colspan="8" class="text-center text-muted">Pas de sortie dans la base de données</td>
                    </tr>
                {%  endif %}
            {% endfor %}
            </tbody>
        </table>
    </div>



{% endblock %}
